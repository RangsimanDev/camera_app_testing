<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TestCamera</title>
    <link rel='stylesheet' href='{% static "css/imagePage.css" %}'>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="imagePage.css">
</head>

<body>
    <main>
        <div class='title'>
            <p>วัดความสุกและดิบของทุเรียน</p>
            <p class='subtitle'>“ ด้วยภาพ ”</p>
        </div>
        <div class='container'>
            <video id='player' style='display: none;' autoplay></video>
            <canvas id='canvas' width="740" height="568" style='display: none;'></canvas>
        </div>
        <div class='btn-group'>
            <button type='button' class='btn' id='start-camera'>
                <span class="material-symbols-outlined" style="font-size: 50px;">photo_camera</span>
            </button>

            <button type='button' id='capture' style='display: none;' class='btn'>
                <span class="material-symbols-outlined"
                    style="font-size: 80px; display: flex; justify-content: center;">camera</span>
            </button>
            <button id="switch-camera" style="width: 30rem; height:10rem;">Switch Camera</button>
        </div>

        <script>
            let player = document.getElementById('player');
            let track;
            let constraints = { video: { facingMode: 'environment' } };
            document.getElementById('start-camera').addEventListener('click', startCamera);
            document.getElementById('switch-camera').addEventListener('click', switchCamera);

            function startCamera() {
                navigator.mediaDevices.getUserMedia(constraints)
                    .then(function (stream) {
                        track = stream.getTracks()[0];
                        player.srcObject = stream;
                    })
                    .catch(function (err) {
                        console.error('Error accessing the camera: ', err);
                    });

                toggleElementsVisibility();
            }

            function switchCamera() {
                if (track) {
                    track.stop();
                }

                if (constraints.video.facingMode === 'environment') {
                    constraints.video.facingMode = 'user'; // switch to front-facing camera
                } else {
                    constraints.video.facingMode = 'environment'; // switch to back-facing camera
                }

                startCamera();
            }

            function toggleElementsVisibility() {
                let elements = ['player', 'start-camera', 'switch-camera'];

                elements.forEach(id => {
                    let element = document.getElementById(id);
                    if (element.style.display === 'none') {
                        element.style.display = 'block';
                    } else {
                        element.style.display = 'none';
                    }
                });
            }
        </script>
    </main>
</body>

</html>